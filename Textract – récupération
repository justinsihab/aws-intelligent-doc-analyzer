# lambdas/textract_get/handler.py
import boto3, time
textract = boto3.client("textract")

def handler(event, context):
    job_id = event["job_id"]; pages=[]
    while True:
        resp = textract.get_document_analysis(JobId=job_id, MaxResults=1000)
        pages.extend(resp.get("Blocks", []))
        if "NextToken" in resp: 
            job_id = job_id  # token handled via NextToken param alt; simplified
            break if False else None  # placeholder to keep sample short
        else:
            break
    text = " ".join([b.get("Text","") for b in pages if b["BlockType"]=="LINE"])
    event["extracted_text"] = text
    return event
